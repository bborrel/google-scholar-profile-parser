os: linux

dist: jammy

language: php

jobs:
    include:
        - php: '8.1'
        - php: '8.2'
        - php: '8.3'

env:
    global:
        # Infection + Stryker
        - secure: n8zm0kktqaFhDgBN/6/gDrQeBq8lOHJ8JWovS9ag0hMfZO8J3jmxLINatQ+WFfwI2tpVUZ3WCQwcPV2eFzks6ZGayXuTLaglosh9thdEMYfE/3per3OTtPLKOv/y6a0LZR089+QipnC+pRcj3ZWg2+dNRF4r1p/QQvlI4Ah12GQ3PFeYQCd9NqG4ugzerSXJxtwEMCRMEJlHEiVFbn3NJfddJ0oyVVbrVBB4cw45HtEmD0TeizHThX19a0jL8qTL56xSPFNh3ZJkZRh9Ir0+HFCZW74ZsdZaMX5K85tlZLc/+JSX5/LB3VDB/k3jmqIdCtxWjSIjmG04qTEZjb7+iZ1q1mNuu0GC5zEPJ58jKSbYxk4EI/gpLE+abircWV1colI0AMAIkqiBP7wz7uyKeAgZeoFcAeXLAePMt23csHfT4FxC/2wFxeJL29k4TK3qNyOJygiCeu8KqIBZtefuvEFVwX143Ztuein5fYapP8/YqvBZOWDdHJeRAWcV4he6qrZUktoQ7bq9I9LAEdwE1RMdIzhx8R0aUZU0xXM2LtpzAMOZG82QIgPBOartPtXidhUo3XpkIKMav8WmRZcEmpv2jlnUINbGnZab3KpF3nUA8g3gMyJxdLEP5KwQWq+cvPIIHlvjKO7kUZfZ6/NtLHKInn54H9Pz58aQh0x1Ujk=
        # Code Climate
        - CC_TEST_REPORTER_ID=99c70ca53c6e46630bf431f10278379710ade7f2a836b2046522a38be6d5841e
        # xDebug 3
        - XDEBUG_MODE=coverage

install:
    - composer --no-interaction --no-progress install

before_script:
    - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
    - chmod +x ./cc-test-reporter
    - ./cc-test-reporter before-build

script:
    - mkdir -p build/logs
    - ./vendor/bin/phpunit
    - ./vendor/bin/infection --min-msi=65 --threads=4 --show-mutations
    - ./vendor/bin/phpcs -p --standard=PHPCompatibility --runtime-set testVersion 8.1- src
    - composer audit --abandoned=ignore

after_script:
    - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT

after_success:
    - travis_retry ./vendor/bin/php-coveralls -v
